<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Aptos Voting DApp</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 50px;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    #status {
      margin-top: 20px;
      font-weight: bold;
    }
    #tx {
      margin-top: 10px;
      color: blue;
    }
  </style>
</head>
<body>
  <h2>üó≥Ô∏è Aptos Voting DApp (Devnet)</h2>

  <button id="connectBtn">üîó Connect Wallet</button>
  <p id="status">Not connected</p>

  <div id="actions" style="display: none;">
    <h3>Cast Your Vote</h3>
    <button onclick="voteYes()">‚úÖ Vote YES</button>
    <button onclick="voteNo()">‚ùå Vote NO</button>
    <p id="tx"></p>
  </div>

  <script type="module">
    import { AptosClient } from "https://cdn.jsdelivr.net/npm/aptos@1.20.0/dist/index.min.js";

    const connectBtn = document.getElementById("connectBtn");
    const statusEl = document.getElementById("status");
    const actions = document.getElementById("actions");
    const txEl = document.getElementById("tx");

    const NODE_URL = "https://fullnode.devnet.aptoslabs.com/v1";
    const client = new AptosClient(NODE_URL);

    let account = null;

    // üîó Connect Wallet
    async function connectWallet() {
      if (!window.aptos) {
        alert("‚ö†Ô∏è Petra wallet not found! Install from https://petra.app/");
        return;
      }
      try {
        account = await window.aptos.connect();
        statusEl.innerText = "‚úÖ Connected: " + account.address;
        actions.style.display = "block";
      } catch (err) {
        console.error(err);
        statusEl.innerText = "‚ùå Connection failed";
      }
    }

    connectBtn.addEventListener("click", connectWallet);

    // üü¢ Vote YES
    async function voteYes() {
      await sendTransaction("vote_yes", [1]); // pollId = 1
    }

    // üî¥ Vote NO
    async function voteNo() {
      await sendTransaction("vote_no", [1]); // pollId = 1
    }

    // üì§ Generic transaction sender
    async function sendTransaction(fn, args) {
      try {
        // TODO: replace with YOUR deployed module address + name
        const moduleAddress = "0xYourModuleAddressHere"; 
        const payload = {
          type: "entry_function_payload",
          function: `${moduleAddress}::voting_system::${fn}`,
          type_arguments: [],
          arguments: args,
        };

        const tx = await window.aptos.signAndSubmitTransaction(payload);
        await client.waitForTransaction(tx.hash);

        txEl.innerHTML = `‚úÖ Tx Submitted: <a href="https://explorer.aptoslabs.com/txn/${tx.hash}?network=devnet" target="_blank">${tx.hash}</a>`;
      } catch (err) {
        console.error("Transaction failed:", err);
        txEl.innerText = "‚ùå Transaction failed (check console)";
      }
    }

    // Expose functions globally
    window.voteYes = voteYes;
    window.voteNo = voteNo;
  </script>
</body>
</html>

